Description: Repair broken migration scripts
 The upstream Alembic migration scripts are quite broken. This patch attemps to
 temporarily fix the issue, without attempting to really understand, waiting
 for a fix from upstream.
Author: Thomas Goirand <zigo@debian.org>
Forwarded: no
Last-Update: 2016-03-24

--- barbican-2.0.0~rc1.orig/barbican/model/migration/alembic_migrations/versions/1c0f328bfce0_fixing_composite_primary_keys_and_.py
+++ barbican-2.0.0~rc1/barbican/model/migration/alembic_migrations/versions/1c0f328bfce0_fixing_composite_primary_keys_and_.py
@@ -34,7 +34,10 @@ def upgrade():
     op.create_index(op.f('ix_order_plugin_metadata_order_id'), 'order_plugin_metadata', ['order_id'], unique=False)
     op.create_index(op.f('ix_order_retry_tasks_order_id'), 'order_retry_tasks', ['order_id'], unique=False)
     op.create_index(op.f('ix_orders_container_id'), 'orders', ['container_id'], unique=False)
-    op.create_index(op.f('ix_orders_project_id'), 'orders', ['project_id'], unique=False)
+    try:
+        op.create_index(op.f('ix_orders_project_id'), 'orders', ['project_id'], unique=False)
+    except:
+        pass
     op.create_index(op.f('ix_orders_secret_id'), 'orders', ['secret_id'], unique=False)
 
     ctx = op.get_context()
--- barbican-2.0.0~rc1.orig/barbican/model/migration/alembic_migrations/versions/d2780d5aa510_change_url_length.py
+++ barbican-2.0.0~rc1/barbican/model/migration/alembic_migrations/versions/d2780d5aa510_change_url_length.py
@@ -15,8 +15,11 @@ import sqlalchemy as sa
 
 
 def upgrade():
-    op.alter_column(
-        'ContainerConsumerMetadatum',
-        'URL',
-        type_=sa.String(length=255)
-    )
+    try:
+        op.alter_column(
+            'ContainerConsumerMetadatum',
+            'URL',
+            type_=sa.String(length=255)
+        )
+    except:
+        pass
\ No newline at end of file
